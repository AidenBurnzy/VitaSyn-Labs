"use strict";(()=>{var e={};e.id=453,e.ids=[453],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},7142:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>u,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l});var n=t(9303),o=t(8716),s=t(670),i=t(3323),c=e([i]);i=(c.then?(await c)():c)[0];let p=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"/workspaces/EvansSarmLab/src/app/api/cart/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:h}=p,E="/api/cart/route";function u(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},3323:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{DELETE:()=>p,GET:()=>c,POST:()=>u,dynamic:()=>d,revalidate:()=>l});var n=t(7070),o=t(5748),s=t(8657),i=e([o]);o=(i.then?(await i)():i)[0];let d="force-dynamic",l=0;async function c(e){try{let r=e.headers.get("authorization"),{userId:t}=(0,s.AY)(r),a=(0,o.Mj)(),i=await a.query("SELECT cart_data FROM user_carts WHERE user_id = $1",[t]);if(0===i.rows.length)return n.NextResponse.json({cart:[]});return n.NextResponse.json({cart:i.rows[0].cart_data})}catch(e){return console.error("Cart GET error:",e),n.NextResponse.json({error:"Failed to fetch cart"},{status:500})}}async function u(e){try{let r=e.headers.get("authorization"),{userId:t}=(0,s.AY)(r),{cart:a}=await e.json(),i=(0,o.Mj)();return await i.query(`INSERT INTO user_carts (user_id, cart_data, updated_at)
       VALUES ($1, $2, NOW())
       ON CONFLICT (user_id) DO UPDATE SET cart_data = $2, updated_at = NOW()`,[t,JSON.stringify(a)]),n.NextResponse.json({success:!0})}catch(e){return console.error("Cart POST error:",e),n.NextResponse.json({error:"Failed to save cart"},{status:500})}}async function p(e){try{let r=e.headers.get("authorization"),{userId:t}=(0,s.AY)(r),a=(0,o.Mj)();return await a.query("DELETE FROM user_carts WHERE user_id = $1",[t]),n.NextResponse.json({success:!0})}catch(e){return console.error("Cart DELETE error:",e),n.NextResponse.json({error:"Failed to clear cart"},{status:500})}}a()}catch(e){a(e)}})},8657:(e,r,t)=>{t.d(r,{Oe:()=>p,RA:()=>c,AY:()=>d,c_:()=>u});var a=t(1482),n=t.n(a);let o=require("bcrypt");var s=t.n(o);let i=process.env.JWT_SECRET||"fallback-secret-key";function c(e){return n().sign(e,i,{expiresIn:"30d"})}async function u(e){return s().hash(e,10)}async function p(e,r){return s().compare(e,r)}function d(e){return function(e){try{return n().verify(e,i)}catch(e){throw Error("Invalid or expired token")}}(function(e){if(!e||!e.startsWith("Bearer "))throw Error("Authorization token required");return e.split(" ")[1]}(e))}},5748:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{Mj:()=>s});var n=t(8678),o=e([n]);n=(o.then?(await o)():o)[0];let i=null;function s(){return i||(i=new n.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})),i}a()}catch(e){a(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972,482],()=>t(7142));module.exports=a})();