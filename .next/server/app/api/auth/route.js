"use strict";(()=>{var e={};e.id=932,e.ids=[932],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},5656:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s=t(9303),n=t(8716),i=t(670),o=t(6714),u=e([o]);o=(u.then?(await u)():u)[0];let c=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/workspaces/EvansSarmLab/src/app/api/auth/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=c,h="/api/auth/route";function l(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}a()}catch(e){a(e)}})},6714:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{POST:()=>u,dynamic:()=>l,revalidate:()=>c});var s=t(7070),n=t(5748),i=t(8657),o=e([n]);n=(o.then?(await o)():o)[0];let l="force-dynamic",c=0;async function u(e){try{let{action:r,email:t,password:a,firstName:o,lastName:u,phone:l}=await e.json();if("register"===r){if(!t||!a||!o||!u)return s.NextResponse.json({error:"All fields are required"},{status:400});let e=(0,n.Mj)();if((await e.query("SELECT id FROM users WHERE email = $1",[t.toLowerCase()])).rows.length>0)return s.NextResponse.json({error:"Email already registered"},{status:409});let r=await (0,i.c_)(a),c=(await e.query(`INSERT INTO users (email, password_hash, first_name, last_name, phone, created_at, last_login)
         VALUES ($1, $2, $3, $4, $5, NOW(), NOW())
         RETURNING id, email, first_name, last_name, phone, created_at`,[t.toLowerCase(),r,o,u,l||null])).rows[0],p=(0,i.RA)({userId:c.id,email:c.email});return s.NextResponse.json({success:!0,token:p,user:{id:c.id,email:c.email,firstName:c.first_name,lastName:c.last_name,phone:c.phone}})}if("login"===r){if(!t||!a)return s.NextResponse.json({error:"Email and password required"},{status:400});let e=(0,n.Mj)(),r=await e.query("SELECT * FROM users WHERE email = $1",[t.toLowerCase()]);if(0===r.rows.length)return s.NextResponse.json({error:"Invalid credentials"},{status:401});let o=r.rows[0];if(!await (0,i.Oe)(a,o.password_hash))return s.NextResponse.json({error:"Invalid credentials"},{status:401});await e.query("UPDATE users SET last_login = NOW() WHERE id = $1",[o.id]);let u=(0,i.RA)({userId:o.id,email:o.email});return s.NextResponse.json({success:!0,token:u,user:{id:o.id,email:o.email,firstName:o.first_name,lastName:o.last_name,phone:o.phone}})}return s.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Auth API error:",e),s.NextResponse.json({error:"Authentication failed"},{status:500})}}a()}catch(e){a(e)}})},8657:(e,r,t)=>{t.d(r,{Oe:()=>c,RA:()=>u,AY:()=>p,c_:()=>l});var a=t(1482),s=t.n(a);let n=require("bcrypt");var i=t.n(n);let o=process.env.JWT_SECRET||"fallback-secret-key";function u(e){return s().sign(e,o,{expiresIn:"30d"})}async function l(e){return i().hash(e,10)}async function c(e,r){return i().compare(e,r)}function p(e){return function(e){try{return s().verify(e,o)}catch(e){throw Error("Invalid or expired token")}}(function(e){if(!e||!e.startsWith("Bearer "))throw Error("Authorization token required");return e.split(" ")[1]}(e))}},5748:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{Mj:()=>i});var s=t(8678),n=e([s]);s=(n.then?(await n)():n)[0];let o=null;function i(){return o||(o=new s.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})),o}a()}catch(e){a(e)}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972,482],()=>t(5656));module.exports=a})();